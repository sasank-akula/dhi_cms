sap.ui.define(["./BaseController","sap/m/MessageToast","sap/m/MessageBox","sap/m/Token","../model/formatter"],function(e,t,a,s,i){"use strict";return e.extend("com.dhi.cms.cmsadmin.controller.CreateAttributes",{formatter:i,onInit:function(){this.getRouter().getRoute("Create Attributes").attachPatternMatched(this._onObjectMatched,this)},_onObjectMatched:function(e){var t=e.getParameter("name");this.attributeId=e.getParameter("arguments").attributeId;var a=!!this.attributeId;this.getModel("appModel").setProperty("/isEditMode",a);var s=a?this.getResourceBundle().getText("Update_Attribute_Title"):this.getResourceBundle().getText("Create_Attribute_Title");this.getView().byId("createAttributeTitle").setText(s);if(!this.attributeId){this.getModel("appModel").setProperty("/Attributes",{})}else{this._fnReadAttributes(this.attributeId)}this._fnRegisterMessageManager()},_fnReadAttributes:function(e){debugger;var t=this;this.getModel("oDataV2").read("/Attributes("+e+")",{success:function(e,a){debugger;t.getModel("appModel").setProperty("/Attributes",e)},error:function(e){a.error(`${e.message}: ${e.statusCode} ${JSON.parse(e.responseText).error.message.value}`)}})},onSave:function(){var e=true;var t=this.byId("attributeNameInput").getValue();var a=this.byId("AttributeTypeSelect").getValue();var s=this.byId("aliasNameAttrInput").getValue();var i=this.byId("associationsSelect").getValue();var r=this.getView().getModel("appModel").getProperty("/Attributes/type");if(t===""){this.byId("attributeNameInput").setValueState("Error");this.byId("attributeNameInput").setValueStateText("This field is required.");e=false}else{this.byId("attributeNameInput").setValueState("None")}if(a===""){this.byId("AttributeTypeSelect").setValueState("Error");this.byId("AttributeTypeSelect").setValueStateText("This field is required.");e=false}else{this.byId("AttributeTypeSelect").setValueState("None")}if(s===""){this.byId("aliasNameAttrInput").setValueState("Error");this.byId("aliasNameAttrInput").setValueStateText("This field is required.");e=false}else{this.byId("aliasNameAttrInput").setValueState("None")}if(r==="Association"&&i===""){this.byId("associationsSelect").setValueState("Error");this.byId("associationsSelect").setValueStateText("This field is required.");e=false}else{this.byId("associationsSelect").setValueState("None")}if(e===true){this.handleSaveAttribute();this.byId("attributeNameInput").setValueState("None");this.byId("AttributeTypeSelect").setValueState("None");this.byId("aliasNameAttrInput").setValueState("None");this.byId("associationsSelect").setValueState("None");this.onNavigation("Attributes")}},attributeTypeChange:function(e){var t=e.getParameter("selectedItem").getKey();var a=this.byId("associationsSelect");var s=this.byId("attributeTypeInput");a.setValue("");if(t=="number"||t=="integer"){s.setType("Number")}else{s.setType("Text")}},resetValueStates:function(e){if(e.getSource().getText("text")!=="Save"){this.onNavigation("Attributes")}this.byId("attributeNameInput").setValueState("None");this.byId("AttributeTypeSelect").setValueState("None");this.byId("aliasNameAttrInput").setValueState("None")},handleSaveAttribute:function(e){var t=this;var s=this.getResourceBundle();var i=this.getModel();var r=this.getModel("appModel").getData().Attributes;var u={ID:r.ID,attribute_id:r.attribute_id,name:r.name,desc:r.desc,alias:r.alias,type:r.type,value:r.value,regex:r.regex,status:r.status,is_mandatory:this.byId("isMandatorySwitch").getState(),minlength:r.minlength,maxlength:r.maxlength};if(r.ID===undefined){var n=i.bindList("/Attributes",undefined,undefined,undefined,undefined);this.oContext=n.create(u,{bSkipRefresh:true});this._refreshMessageManager();this.getModel().submitBatch("$auto").then(function(e){var i=t.getModel("message").getData();var r=i.slice().reverse().find(e=>e.type==="Error");if(r){r&&a.error(r.message);t._refreshMessageManager();return}else{var u=t.getModel().bindContext(`/Attributes`,undefined,undefined,undefined,undefined);u.requestObject().then(e=>{console.log(e);var i=t.getModel("appModel").getData().Attributes;var r=e.value.filter(e=>e.name==i.name);console.log(r);a.success(s.getText("attributeSaveSuccess"));t._fnReadAttributes(r[0].ID);t._refreshMessageManager()})}})}else{this._refreshMessageManager();this.getModel("oDataV2").update("/Attributes(guid'"+r.ID+"')",u,{success:function(e,t){a.success(s.getText("attributeUpdateSuccess"))},error:function(e){a.error(`${e.message}: ${e.statusCode} ${JSON.parse(e.responseText).error.message.value}`)}})}}})});
//# sourceMappingURL=CreateAttributes.controller.js.map