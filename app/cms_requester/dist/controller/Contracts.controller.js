sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageBox","sap/m/MessageToast","sap/ui/table/TablePersoController","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/FilterType","sap/ui/core/Fragment","sap/ui/export/Spreadsheet","sap/ui/export/library"],(e,t,r,o,n,i,l,s,a,c)=>{"use strict";var u=c.EdmType;return e.extend("com.dhi.cms.cmsrequester.controller.Contracts",{onInit(){this.getRouter().getRoute("Contracts").attachPatternMatched(this._onObjectMatched,this)},getRouter:function(){return this.getOwnerComponent().getRouter()},onGoBtnPress:function(e){let t=this.byId("idFilterBar");let o=t.getAllFilterItems();let i=[];o.forEach(e=>{let t=e.getName();let r;if(t==="contract_id"){let r=e.getControl().getValue();if(r){i.push(new n(t,"Contains",r))}}else{r=e.getControl().getSelectedKeys();if(r){r.forEach(e=>{i.push(new n(t,"EQ",e))})}}});let l=this.byId("tblContracts");let s=l.getBinding("rows");s.filter(i);r.show("Filters Applied Sucessfully.")},onClearFilters:function(){this.byId("tblContracts").getBinding("rows").filter([]);r.show("Filters cleared Sucessfully.")},onCreateContract:function(e){var t=this.getOwnerComponent().getRouter();var e;if(e){t.navTo(e)}else{console.error("Navigation target not defined.")}},onEditContract:async function(e){const t=e.getSource();const r=t.getBindingContext();if(!r)return;const o=r.getProperty("ID");const n=this.getView().getModel();const i=`/Contracts('${o}')`;let l=n.bindContext(i,undefined,{$expand:"attribute_values"});let s=await l.requestObject().then(function(e){console.log(e);return e});console.log("Server contract + attribute_values:",s);this.getView().getModel("contractModel").setData(s)},_onObjectMatched:function(e){this._refreshTable();this._setPersonalization();this.clearAllFilters()},onExportData:function(e){let t=this.byId("tblContracts");let r=t.getBinding("rows");let o=this.createColumnConfig();let n={workbook:{columns:o,hierarchyLevel:"Level"},dataSource:r,fileName:"Contracts.xlsx",worker:false};let i=new a(n);i.build().finally(function(){i.destroy()})},createColumnConfig:function(){var e=[];e.push({label:"ID",property:"ID",type:u.String});e.push({label:"Contract Name",property:"alias",type:u.String});e.push({label:"Contract ID",property:"contract_id",type:u.String});e.push({label:"Description",property:"description",type:u.String});e.push({label:"Contract Type",property:"templates/name",type:u.String});e.push({label:"Start Date",property:"start_date",type:u.DateTime});e.push({label:"End Date",property:"end_date",type:u.DateTime});return e},onProductDelete:function(e){let r=this.getResourceBundle();let o=ProductManager.getInstance();let n=e.getSource().getBindingContext();let{ID:i,name:l}=n.getObject();t.warning(r.getText("confirmDeleteProduct",[l]),{actions:[t.Action.YES,t.Action.NO],emphasizedAction:t.Action.YES,initialFocus:t.Action.NO,onClose:e=>{if(e===t.Action.YES){o.deleteProduct(i).then(()=>{this._refreshTable();t.success(r.getText("productDeleted",[l]))}).catch(e=>{t.error(r.getText("productDeleteError",[l]))})}},dependentOn:this.getView()})},_refreshTable:function(){this.byId("tblContracts").getBinding("rows").refresh()},onProductEdit:function(e){let t=e.getSource().getBindingContext();let{ID:r}=t.getObject();this.getRouter().navTo("Create Products",{productId:r})},onClearFilters:function(){this.byId("clearFilters").setEnabled(false);this.clearAllFilters()},clearAllFilters:function(){var e=this.byId("tblContracts");var t=null;var r=e.getColumns();for(var o=0;o<r.length;o++){e.filter(r[o],null)}this.byId("tblContracts").getBinding("rows").filter(t,"Application");this.byId("tblContracts").getBinding("rows").filter([])},onTableFilter:function(e){var t=e.getParameter("value");var r=this.byId("tblContracts");var o=r.getBinding("rows");if(t){this.byId("clearFilters").setEnabled(true);var i=r.getColumns();var l=[];i.forEach(function(e){var r=e.getFilterProperty();if(r){var o=new n({path:r,operator:sap.ui.model.FilterOperator.Contains,value1:t,caseSensitive:false});l.push(o)}});var s=new sap.ui.model.Filter({filters:l,and:false});o.filter(s,sap.ui.model.FilterType.Application);e.preventDefault()}else{this.byId("clearFilters").setEnabled(false);o.filter([],sap.ui.model.FilterType.Application)}},_setPersonalization:function(){var e,t,r={oPersoData:{_persoSchemaVersion:"1.0",aColumns:[]},getPersData:function(){t=new jQuery.Deferred;if(!this._oBundle){this._oBundle=this.oPersoData}e=this._oBundle;t.resolve(e);return t.promise()},setPersData:function(e){t=new jQuery.Deferred;this._oBundle=e;t.resolve();return t.promise()},delPersData:function(){t=new jQuery.Deferred;t.resolve();return t.promise()}};this.oTablePersoController=new o({table:this.byId("tblContracts"),persoService:r})},onPersonalization:function(){this.oTablePersoController.openDialog()},onRowsUpdated:function(){var e=this.byId("tblContracts");this.getModel("appModel").setProperty("/ProductCount",e.getBinding("rows").getLength())}})});
//# sourceMappingURL=Contracts.controller.js.map