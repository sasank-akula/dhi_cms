sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageBox"],(t,e)=>{"use strict";return t.extend("com.dhi.cms.cmsrequester.controller.ContractDetails",{onInit(){this.getRouter().getRoute("ContractDetails").attachPatternMatched(this._onObjectMatched,this)},_onObjectMatched:function(t){this._SelectedContractType;const e=t.getParameter("arguments");this.contractId=e.contractId;const r=t.getParameter("name");const o=!!this.contractId;this._focusOnBasicInfoTab()},getRouter:function(){return this.getOwnerComponent().getRouter()},_initializeViewState:function(t,e,r){this.getModel("appModel").setProperty("/isEditMode",e);this._handleProductData(t)},_focusOnBasicInfoTab:function(){const t=this.byId("iconTabBar");t.setSelectedKey("BasicInfo");const e=t.getItems()[0].getDomRef();if(e){e.focus()}},onTabSelect:function(t){let r=t.getParameters().selectedKey;let o=this.byId("contractTypeSelect").getSelectedKey();if(!this.byId("contractTypeSelect").getSelectedKey()){t.getSource().setSelectedKey("BasicInfo");e.warning("Please select the Contract Type");return}if(r!="BasicInfo"){if(this._SelectedContractType!=o){this.initializeDetails()}}this._SelectedContractType=o},initializeDetails:function(){const t=this.getOwnerComponent().getModel();let e=this.byId("contractTypeSelect").getSelectedKey();const r=this;const o=`/TemplatePortalCatalogue(TemplateID='${e}')`;const n=t.bindContext(o);const i=n.getBoundContext();this.productSpecificationBinding=t.bindList("Set",i,[],[],{$$ownRequest:true});this.model=t;this.isBound=true;return this.productSpecificationBinding.requestContexts(0,100).then(function(t){const e=t.map(function(t){return t.getObject()});const o={};e.forEach(function(t){const e=t.Attribute_Groups_ID||"defaultGroup";if(!o[e]){o[e]={Attribute_Groups_ID:e,Attribute_Group_Name:t.Attribute_Group_Name||"Group",Attribute_Group_Role:t.Attribute_Group_Role||"",AttributeGroupOrder:t.AttributeGroupOrder||0,Attributes:[]}}const r={Attribute_ID:t.Attribute_ID,Attribute_Name:t.Attribute_Name,AttributeOrder:t.AttributeOrder||0,IsMandatory:!!t.Is_Required,AttributeType:t.AttributeType||"String",AttributeValue:t.AttributeValue||"",AttributeTypeAssociation:t.AttributeTypeAssociation||[],Value:t.Value||"",IsPortalEnabled:typeof t.IsPortalEnabled!=="undefined"?t.IsPortalEnabled:null,Portal_ID:t.Portal_ID||null};o[e].Attributes.push(r)});let n=Object.keys(o).map(function(t){return o[t]});n.sort(function(t,e){return t.AttributeGroupOrder-e.AttributeGroupOrder});n.forEach(function(t){t.Attributes.sort(function(t,e){return t.AttributeOrder-e.AttributeOrder})});const i={AttributeGroups:n};r.getOwnerComponent().getModel("Details").setData(i);console.log(r.getOwnerComponent().getModel("Details").getData());return i}).catch(function(t){jQuery.sap.log.error("Failed to load TemplatePortalCatalogue Set",t);throw t})},onNavigation:function(t){var e=this.getOwnerComponent().getRouter();var t;if(t){e.navTo(t)}else{console.error("Navigation target not defined.")}},handleSaveContractDetails:function(){console.log(this.getView().getModel("Details").getData())},formatDate:function(t){if(!t){return""}try{var e=new Date(t);if(isNaN(e.getTime())){return t}var r=function(t){return t<10?"0"+t:t};return e.getFullYear()+"-"+r(e.getMonth()+1)+"-"+r(e.getDate())}catch(e){return t}},formatAttribute:function(t,e){if(t===null||typeof t==="undefined"||t===""){return""}if(e==="CheckBox"){if(t===true||t==="true"||t==="1"||t===1){return"Yes"}return"No"}if(e==="DatePicker"){return this.formatDate(t)}if(e==="MultiInput"){if(Array.isArray(t)){return t.join(", ")}return String(t)}return String(t)},onUploadCompleted:function(t){let e=t.getParameters().item;let r=this.getOwnerComponent().getModel("contractModel").getProperty("/attachments");let o=Array.isArray(e)?e:[e];o.map(function(t){r.push({fileName:t.getFileName(),mediaType:t.getMediaType?t.getMediaType():t.mProperties.mediaType,fileSize:t.getFileSize?t.getFileSize():t.mProperties.fileSize,uploadState:t.getUploadState?t.getUploadState():t.mProperties.uploadState,uploadedOn:t.getUploadedOn&&t.getUploadedOn()||t.mProperties.uploadedOn||null})});console.log("Mapped upload results:",r);this.getOwnerComponent().getModel("contractModel").setProperty("/attachments",r)}})});
//# sourceMappingURL=ContractDetails.controller.js.map