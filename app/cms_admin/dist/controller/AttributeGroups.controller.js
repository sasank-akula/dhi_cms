sap.ui.define(["./BaseController","sap/m/MessageBox","sap/m/MessageToast","sap/ui/table/TablePersoController","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/FilterType"],function(e,t,r,o,i,n,s){"use strict";return e.extend("com.dhi.cms.cmsadmin.controller.AttributeGroups",{onInit:function(){this.getRouter().getRoute("Attribute Groups").attachPatternMatched(this._onObjectMatched,this)},_onObjectMatched:function(e){var t=e.getParameter("name");this._updateBreadcrumbs(t);this._refreshTable();this._setPersonalization();this.clearAllFilters();this._getAttributeGrpList()},_createTokens:function(e){return e.map(function(e){return new Token({key:e.name,text:e.name})})},_getAttributeGrpList:function(){var e=this.byId("tblAttributeGroups");var t=this.getOwnerComponent().getModel();var r=t.bindList("/getGroupAssociatedTemplates()",undefined,undefined,undefined);var o=this.getModel("appModel");e.setBusy(true);r.requestContexts().then(function(t){var r=t.map(e=>({ID:e.getProperty("ID"),ATTRIBUTE_GROUP_ID:e.getProperty("ATTRIBUTE_GROUP_ID"),NAME:e.getProperty("NAME"),DESC:e.getProperty("DESC"),ALIAS:e.getProperty("ALIAS"),ROLE:e.getProperty("ROLE"),TEMPLATE_NAME:e.getProperty("TEMPLATE_NAME")}));o.setProperty("/attributeAssociatedTemplates",r);e.setModel(o,"appModel");e.bindRows("appModel>/attributeAssociatedTemplates")}).catch(function(e){console.error("Error fetching contexts:",e)}).finally(function(){e.setBusy(false)})},onAttributeGroupEdit:function(e){let t=e.getSource().getBindingContext("appModel");let{ID:r}=t.getObject();this.getRouter().navTo("Create Attribute Group",{attributeGroupId:r})},onAttributeGroupDelete:function(e){let o=this.getResourceBundle();var i=e.getSource().getBindingContext("appModel").getObject().NAME;var n=e.getSource().getBindingContext("appModel").getObject().ID;var s=this.getOwnerComponent();var a=s.getModel();let l=`/Attribute_Groups(${n})`;var u={$expand:"templates($expand=templates),attributes($expand=attribute)"};let p=a.bindContext(l,null,u);var d=this;let c=o.getText("attributeGroupDeleteConfirmationMessage",[i]);t.warning(c,{icon:t.Icon.WARNING,actions:[t.Action.YES,t.Action.NO],emphasizedAction:t.Action.YES,initialFocus:t.Action.NO,dependentOn:this.getView(),onClose:e=>{if(e==="YES"){let e=p.getBoundContext();e.requestObject().then(n=>{console.log(n);e.delete().then(function(){let e=o.getText("attributeGroupDeleteSuccessMessage",[i]);r.show(e);d._getAttributeGrpList()}).catch(function(e){let r=o.getText("attributeGroupDeleteErrorMessage",[i]);t.error(r)})})}}})},_refreshTable:function(){this.byId("tblAttributeGroups").getBinding("rows").refresh()},onClearFilters:function(){this.byId("clearFilters").setEnabled(false);this.clearAllFilters()},clearAllFilters:function(){var e=this.byId("tblAttributeGroups");var t=null;var r=e.getColumns();for(var o=0;o<r.length;o++){e.filter(r[o],null)}this.byId("tblAttributeGroups").getBinding("rows").filter(t,"Application")},onTableFilter:function(e){var t=e.getParameter("value");var r=this.byId("tblAttributeGroups");var o=r.getBinding("rows");if(t){this.byId("clearFilters").setEnabled(true);var n=r.getColumns();var s=[];n.forEach(function(e){var r=e.getFilterProperty();if(r){var o=new i({path:r,operator:sap.ui.model.FilterOperator.Contains,value1:t,caseSensitive:false});s.push(o)}});var a=new sap.ui.model.Filter({filters:s,and:false});o.filter(a,sap.ui.model.FilterType.Application);e.preventDefault()}else{this.byId("clearFilters").setEnabled(false);o.filter([],sap.ui.model.FilterType.Application)}},_setPersonalization:function(){var e,t,r={oPersoData:{_persoSchemaVersion:"1.0",aColumns:[]},getPersData:function(){t=new jQuery.Deferred;if(!this._oBundle){this._oBundle=this.oPersoData}e=this._oBundle;t.resolve(e);return t.promise()},setPersData:function(e){t=new jQuery.Deferred;this._oBundle=e;t.resolve();return t.promise()},delPersData:function(){t=new jQuery.Deferred;t.resolve();return t.promise()}};this.oTablePersoController=new o({table:this.byId("tblAttributeGroups"),persoService:r})},onPersonalization:function(){this.oTablePersoController.openDialog()},onRowsUpdated:function(){var e=this.byId("tblAttributeGroups");this.getModel("appModel").setProperty("/AttributeGroupCount",e.getBinding("rows").getLength())}})});
//# sourceMappingURL=AttributeGroups.controller.js.map