sap.ui.define(["./BaseController","sap/ui/core/mvc/Controller","sap/m/MessageBox","sap/m/MessageToast","sap/ui/table/TablePersoController","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/FilterType","sap/ui/core/Fragment","sap/ui/export/Spreadsheet","sap/ui/export/library","sap/ui/core/BusyIndicator"],(e,t,r,o,s,n,a,l,i,c,u,d)=>{"use strict";var p=u.EdmType;return e.extend("com.dhi.cms.cmsrequester.controller.Contracts",{onInit(){this.getRouter().getRoute("Contracts").attachPatternMatched(this._onObjectMatched,this)},_onObjectMatched:function(e){this._refreshTable();this._setPersonalization();this.clearAllFilters()},onGoBtnPress:function(e){let t=this.byId("idFilterBar");let r=t.getAllFilterItems();let s=[];r.forEach(e=>{let t=e.getName();let r;if(t==="contract_id"){let r=e.getControl().getValue();if(r){s.push(new n(t,"Contains",r))}}else{r=e.getControl().getSelectedKeys();if(r){r.forEach(e=>{s.push(new n(t,"EQ",e))})}}});let a=this.byId("tblContracts");let l=a.getBinding("rows");l.filter(s);o.show("Filters Applied Sucessfully.")},onClearFilters:function(){this.byId("tblContracts").getBinding("rows").filter([]);o.show("Filters cleared Sucessfully.")},onExportData:function(e){let t=this.byId("tblContracts");let r=t.getBinding("rows");let o=this.createColumnConfig();let s={workbook:{columns:o,hierarchyLevel:"Level"},dataSource:r,fileName:"Contracts.xlsx",worker:false};let n=new c(s);n.build().finally(function(){n.destroy()})},createColumnConfig:function(){var e=[];e.push({label:"ID",property:"ID",type:p.String});e.push({label:"Contract Name",property:"alias",type:p.String});e.push({label:"Contract ID",property:"contract_id",type:p.String});e.push({label:"Description",property:"description",type:p.String});e.push({label:"Contract Type",property:"templates/name",type:p.String});e.push({label:"Start Date",property:"start_date",type:p.DateTime});e.push({label:"End Date",property:"end_date",type:p.DateTime});return e},_refreshTable:function(){this.byId("tblContracts").getBinding("rows").refresh()},onClearFilters:function(){this.byId("clearFilters").setEnabled(false);this.clearAllFilters()},clearAllFilters:function(){var e=this.byId("tblContracts");var t=null;var r=e.getColumns();for(var o=0;o<r.length;o++){e.filter(r[o],null)}this.byId("tblContracts").getBinding("rows").filter(t,"Application");this.byId("tblContracts").getBinding("rows").filter([])},onTableFilter:function(e){var t=e.getParameter("value");var r=this.byId("tblContracts");var o=r.getBinding("rows");if(t){this.byId("clearFilters").setEnabled(true);var s=r.getColumns();var a=[];s.forEach(function(e){var r=e.getFilterProperty();if(r){var o=new n({path:r,operator:sap.ui.model.FilterOperator.Contains,value1:t,caseSensitive:false});a.push(o)}});var l=new sap.ui.model.Filter({filters:a,and:false});o.filter(l,sap.ui.model.FilterType.Application);e.preventDefault()}else{this.byId("clearFilters").setEnabled(false);o.filter([],sap.ui.model.FilterType.Application)}},_setPersonalization:function(){var e,t,r={oPersoData:{_persoSchemaVersion:"1.0",aColumns:[]},getPersData:function(){t=new jQuery.Deferred;if(!this._oBundle){this._oBundle=this.oPersoData}e=this._oBundle;t.resolve(e);return t.promise()},setPersData:function(e){t=new jQuery.Deferred;this._oBundle=e;t.resolve();return t.promise()},delPersData:function(){t=new jQuery.Deferred;t.resolve();return t.promise()}};this.oTablePersoController=new s({table:this.byId("tblContracts"),persoService:r})},onPersonalization:function(){this.oTablePersoController.openDialog()},onRowsUpdated:function(){var e=this.byId("tblContracts");this.getModel("appModel").setProperty("/ContractCount",e.getBinding("rows").getLength())},onCreateContract:function(e){var e;if(e){this.getRouter().navTo(e)}else{console.error("Navigation target not defined.")}},onDeleteContract:function(e){const t=this.getView();const s=e.getSource();const n=s.getBindingContext();if(!n){sap.m.MessageToast.show("No contract selected for delete.");return}const a=n.getProperty("alias")||n.getProperty("contract_id")||"this contract";const l=`Are you sure you want to delete ${a}?`;r.confirm(l,{title:"Confirm delete",onClose:e=>{if(e!==sap.m.MessageBox.Action.OK){return}t.setBusy(true);n.delete().then(()=>{t.setBusy(false);o.show("Contract deleted");const e=t.getModel();try{e.refresh(true)}catch(e){}}).catch(e=>{t.setBusy(false);const o=e&&e.message?e.message:"Delete failed";r.error("Failed to delete contract: "+o);try{t.getModel().refresh(true)}catch(e){}})}})},onEditContract:function(e){let t=e.getSource().getBindingContext();let{ID:r}=t.getObject();this.getRouter().navTo("ContractDetails",{contractId:r})}})});
//# sourceMappingURL=Contracts.controller.js.map